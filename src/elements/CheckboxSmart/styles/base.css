@keyframes checkbox-spinner {
  100% {
    transform: rotate(180deg);
  }
}

.checkbox-smart {
  --icon-size: 1.1em;
  --icon-background-color: rgba(255, 255, 255, 0.25);
  --icon-border-color: var(--control-border-color);
  --element-border-color: var(--control-border-color);

  position: relative;
  display: inline-flex;
  align-items: flex-start;
  margin: 0;
  padding: 0.75em 1em;
  gap: 0.5em;
  font-size: var(--font-size-base);
  line-height: 1.3em;
  color: var(--control-text-color);
  cursor: pointer;
  border-style: solid;
  border-width: var(--control-border-width);
  border-radius: var(--control-border-radius);
  border-color: var(--element-border-color);
  background-color: var(--control-background-color);

  &._checked {
    --element-border-color: var(--color-first);
    outline: 1px solid var(--element-border-color);
    outline-offset: 0;

    &.checkbox-smart--grey {
      --element-border-color: var(--color-grey);
    }

    &.checkbox-smart--second {
      --element-border-color: var(--color-second);
    }

    &.checkbox-smart--third {
      --element-border-color: var(--color-third);
    }

    &.checkbox-smart--success {
      --element-border-color: var(--color-success);
    }

    &.checkbox-smart--error {
      --element-border-color: var(--color-error);
    }
  }

  &._disabled {
    opacity: 0.6;
    pointer-events: none;
  }

  &._waiting {
    cursor: default;
    pointer-events: none;
  }
}

.checkbox-smart--micro {
  font-size: var(--font-size-micro);
}

.checkbox-smart--small {
  font-size: var(--font-size-small);
}

.checkbox-smart--large {
  font-size: var(--font-size-large);
}

.checkbox-smart--extra {
  font-size: var(--font-size-extra);
}

.checkbox-smart__field {
  font-size: inherit;
  position: absolute;
  left: 1em;
  top: 0.75em;
  width: var(--icon-size);
  height: var(--icon-size);
  margin: 0;

  .checkbox-smart._waiting & {
    display: none;
  }
}

.checkbox-smart__icon {
  position: relative;
  width: var(--icon-size);
  height: var(--icon-size);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  background-color: var(--icon-background-color);
  background-position: center;
  background-size: 50%;
  background-repeat: no-repeat;
  border: 1.5px solid var(--icon-border-color);
  border-radius: 3px;
  cursor: pointer;

  /* default state */

  .checkbox-smart:not(._disabled):hover & {
    --icon-background-color: var(--color-first-trans-90);
    --icon-border-color: var(--color-first);

    &._color-grey {
      --icon-background-color: var(--color-grey-trans-90);
      --icon-border-color: var(--color-grey);
    }

    &._color-second {
      --icon-background-color: var(--color-second-trans-90);
      --icon-border-color: var(--color-second);
    }

    &._color-third {
      --icon-background-color: var(--color-third-trans-90);
      --icon-border-color: var(--color-third);
    }

    &._color-success {
      --icon-background-color: var(--color-success-trans-90);
      --icon-border-color: var(--color-success);
    }

    &._color-error {
      --icon-background-color: var(--color-error-trans-90);
      --icon-border-color: var(--color-error);
    }
  }

  .checkbox-smart:not(._disabled):active & {
    --icon-background-color: var(--color-first-trans-80);
    --icon-border-color: var(--color-first);

    &._color-grey {
      --icon-background-color: var(--color-grey-trans-80);
      --icon-border-color: var(--color-grey);
    }

    &._color-second {
      --icon-background-color: var(--color-second-trans-80);
      --icon-border-color: var(--color-second);
    }

    &._color-third {
      --icon-background-color: var(--color-third-trans-80);
      --icon-border-color: var(--color-third);
    }

    &._color-success {
      --icon-background-color: var(--color-success-trans-80);
      --icon-border-color: var(--color-success);
    }

    &._color-error {
      --icon-background-color: var(--color-error-trans-80);
      --icon-border-color: var(--color-error);
    }
  }

  /* checked state */

  .checkbox-smart._checked & {
    --icon-background-color: var(--color-first);
    --icon-border-color: transparent;

    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='white' d='M6.564.75l-3.59 3.612-1.538-1.55L0 4.26 2.974 7.25 8 2.193z'/%3e%3c/svg%3e");

    &._color-grey {
      --icon-background-color: var(--color-grey);
    }

    &._color-second {
      --icon-background-color: var(--color-second);
    }

    &._color-third {
      --icon-background-color: var(--color-third);
    }

    &._color-success {
      --icon-background-color: var(--color-success);
    }

    &._color-error {
      --icon-background-color: var(--color-error);
    }
  }

  .checkbox-smart._checked:not(._disabled):hover & {
    --icon-background-color: var(--color-first-trans-10);

    &._color-grey {
      --icon-background-color: var(--color-grey-trans-10);
    }

    &._color-second {
      --icon-background-color: var(--color-second-trans-10);
    }

    &._color-third {
      --icon-background-color: var(--color-third-trans-10);
    }

    &._color-success {
      --icon-background-color: var(--color-success-trans-10);
    }

    &._color-error {
      --icon-background-color: var(--color-error-trans-10);
    }
  }

  .checkbox-smart._checked:not(._disabled):active & {
    --icon-background-color: var(--color-first-trans-20);

    &._color-grey {
      --icon-background-color: var(--color-grey-trans-20);
    }

    &._color-second {
      --icon-background-color: var(--color-second-trans-20);
    }

    &._color-third {
      --icon-background-color: var(--color-third-trans-20);
    }

    &._color-success {
      --icon-background-color: var(--color-success-trans-20);
    }

    &._color-error {
      --icon-background-color: var(--color-error-trans-20);
    }
  }

  /* invalid state */

  .checkbox-smart._invalid &,
  .checkbox-smart._invalid:hover &,
  .checkbox-smart._invalid:active & {
    --icon-border-color: var(--color-error);
  }
}

.checkbox-smart__spinner {
  stroke-width: 2.5;
  animation: checkbox-spinner 1.5s infinite;
  color: var(--color-first);
  width: var(--icon-size);
}

.checkbox-smart__body {
  display: flex;
  flex-direction: column;
  gap: 0.25em;
  margin-top: -0.125em;
  flex-grow: 1;

  & a[href] {
    color: inherit;
    text-decoration: underline;
    pointer-events: all;

    &:hover {
      text-decoration: none;
    }
  }
}

.checkbox-smart__title {
  font-size: inherit;
  font-family: var(--font-family-title);
  font-weight: var(--font-weight-semibold);
  color: currentColor;
}

.checkbox-smart__caption {
  opacity: 0.75;
  font-size: max(0.8em, var(--font-size-micro));
  font-family: var(--font-family-base);
  font-weight: var(--font-weight-regular);
  line-height: 1.3;
}
